---
import { getCollection, getEntryBySlug } from 'astro:content'
import PostLayout from '../../layouts/PostLayout.astro'

if (!Astro.params.slug) {
	throw new Error('Missing slug')
}

const entry = await getEntryBySlug('blog', Astro.params.slug)

if (!entry) {
	throw new Error('Not found')
}

export async function getStaticPaths() {
	const blogEntries = await getCollection('blog')
	return blogEntries.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}))
}

const { Content } = await entry.render()
---

<PostLayout {...entry.data}>
	<Content />
</PostLayout>
